<?xml version="1.0"?>
<DDDefinition xmlns="http://www.cern.ch/cms/DDL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.cern.ch/cms/DDL ../../../DetectorDescription/Schema/DDLSchema.xsd">

<ConstantsSection label="pixfwdInnerDisk1.xml" eval="true">
  <Constant name="AnchorZ"              value="2.0*mm"/>

  <Constant name="InnerRingRMin"        value="36.88*mm"/>
  <Constant name="InnerRingRMax"        value="[InnerRingRMin]+2.5*mm"/>
  <Constant name="InnerRingCFRMax"        value="[InnerRingRMin]"/>
  <Constant name="InnerRingCFRMin"        value="[InnerRingCFRMax]-0.5*mm"/>
  <Constant name="InnerRingHalfWidth"  value="15.0*mm"/>
  <Constant name="InnerRingZ"           value="[AnchorZ] + 2.5*mm"/>

  <Constant name="OuterRingRMax"        value="117.38*mm"/> 
  <Constant name="OuterRingRMin"        value="[OuterRingRMax]-2.00*mm"/><!-- Should be -2.50*mm collision with current blade -->
  <Constant name="OuterRingCFRMin"        value="[OuterRingRMax]"/>
  <Constant name="OuterRingCFRMax"        value="[OuterRingCFRMin]+0.5*mm"/>
  <Constant name="OuterRingHalfWidth"   value="15.0*mm"/>
  <Constant name="OuterRingZ"           value="[AnchorZ] - 15.0*mm"/>

  <Constant name="InnerRingPhiStart"     value=" 33.862*deg"/><!-- same as in Algorithm -->
  <Constant name="InnerRingPhiEnd"       value="154.862*deg"/><!-- same as in Algorithm -->
  <Constant name="InnerRingTubsCount"    value="20" />
  <Constant name="InnerRingSegmentDPhi"  value="([InnerRingPhiEnd]-[InnerRingPhiStart])/[InnerRingTubsCount]" />
  
  <Constant name="OuterRingPhiStart"     value="  5.0*deg"/><!-- same as in Algorithm -->
  <Constant name="OuterRingPhiEnd"       value="175.0*deg"/><!-- same as in Algorithm -->
  <Constant name="OuterRingTubsCount"    value="40" />
  <Constant name="OuterRingSegmentDPhi"  value="([OuterRingPhiEnd]-[OuterRingPhiStart])/[OuterRingTubsCount]" />

  <Constant name="EndSegment1PhiStart" value="-9.359*deg"/>
  <Constant name="EndSegment1Width"    value="[InnerRingHalfWidth]"/>
  <Constant name="EndSegment2PhiStart" value="12.255*deg"/>
  <Constant name="EndSegment2Width"    value="8.0*mm"/>
  <Constant name="EndSegment3PhiEnd"   value="190.*deg"/>
  <Constant name="EndSegment3Width"    value="17.*mm"/>
  <Constant name="EndSegment4PhiEnd"   value="([EndSegment3PhiEnd] + [InnerRingPhiEnd]) / 2."/>
  <Constant name="EndSegment4Width"    value="9.2*mm"/>
  <Constant name="EndSegmentSide1Z"    value="22.*mm"/>
  <Constant name="EndSegmentSide2Z"    value="[EndSegmentSide1Z] - 43.75*mm"/>

</ConstantsSection>
 


<!-- Blades -->

<Algorithm name="track:DDPixFwdDiskAlgo">
  <rParent name="pixfwdDisks:PixelForwardDisk1"/>
  <String  name="ChildName"        value="pixfwdblade1:PixelForwardBlade"/> 
  <Numeric name="StartCopyNo"      value="0"/>
  <Numeric name="NumberOfBlades"   value="11"/>
  <Numeric name="BladeAngle"       value="20*deg"/>
  <Numeric name="BladeTilt"        value="12*deg"/>
  <Numeric name="BladeCommonZ"     value="[AnchorZ] + 0*mm"/><!--16.45*mm --> <!-- -18.7*mm-->
  <Vector name="BladeZShift" type="numeric" nEntries="11">
    4.727*mm, 0.727*mm, -3.273*mm, -7.273*mm, -11.273*mm,
    4.727*mm, 0.727*mm, -3.273*mm, -7.273*mm, -11.273*mm, -16.273*mm
  </Vector>

  <Numeric name="AnchorRadius"    value="78.7*mm"/>
  <String  name="RotationName"    value="pixfwdInnerDisk1:PixInner"/>
 <String  name="FlagString"      value="YYYYYYYYYYYYYYYYYYYYYY"/>
</Algorithm>

<!-- Support rings -->

<SolidSection label="pixfwdInnerDisk1.xml">
  <Tubs name="PixelForwardInnerRingSegment"  startPhi="-[InnerRingSegmentDPhi]/2.0" deltaPhi="[InnerRingSegmentDPhi]"
        rMin="[InnerRingRMin]" rMax="[InnerRingRMax]" dz="[InnerRingHalfWidth]"/>
  <Tubs name="PixelForwardInnerRingCFSegment"  startPhi="-[InnerRingSegmentDPhi]/2.0" deltaPhi="[InnerRingSegmentDPhi]"
        rMin="[InnerRingCFRMin]" rMax="[InnerRingCFRMax]" dz="[InnerRingHalfWidth]"/>

  <Tubs name="PixelForwardOuterRingSegment"  startPhi="-[OuterRingSegmentDPhi]/2.0" deltaPhi="[OuterRingSegmentDPhi]"
        rMin="[OuterRingRMin]" rMax="[OuterRingRMax]" dz="[OuterRingHalfWidth]"/>
  <Tubs name="PixelForwardOuterRingCFSegment"  startPhi="-[OuterRingSegmentDPhi]/2.0" deltaPhi="[OuterRingSegmentDPhi]"
        rMin="[OuterRingCFRMin]" rMax="[OuterRingCFRMax]" dz="[OuterRingHalfWidth]"/>

  <Tubs name="PixelForwardInnerRingEndSegment1" startPhi="90.*deg+[EndSegment1PhiStart]" deltaPhi="[InnerRingPhiStart]-[EndSegment1PhiStart]"
        rMin="[InnerRingRMin]" rMax="[InnerRingRMax]" dz="[EndSegment1Width] / 2.0"/>
  <Tubs name="PixelForwardInnerRingCFEndSegment1" startPhi="90.*deg+[EndSegment1PhiStart]" deltaPhi="[InnerRingPhiStart]-[EndSegment1PhiStart]"
        rMin="[InnerRingCFRMin]" rMax="[InnerRingCFRMax]" dz="[EndSegment1Width] / 2.0"/>
<!--
  <Tubs name="PixelForwardInnerRingEndSegment2" startPhi="90.*deg+[EndSegment2PhiStart]" deltaPhi="[InnerRingPhiStart]-[En\
dSegment2PhiStart]"
        rMin="[InnerRingRMin]" rMax="[InnerRingRMax]" dz="[EndSegment2Width] / 2.0"/>
  <Tubs name="PixelForwardInnerRingCFEndSegment2" startPhi="90.*deg+[EndSegment2PhiStart]" deltaPhi="[InnerRingPhiStart]-[EndSegment2PhiStart]"
        rMin="[InnerRingCFRMin]" rMax="[InnerRingCFRMax]" dz="[EndSegment2Width] / 2.0"/>
--><!-- Bugged in fireworks -->
  <Tubs name="PixelForwardInnerRingEndSegment3" startPhi="90.*deg+[InnerRingPhiEnd]" deltaPhi="-[InnerRingPhiEnd]+[EndSegment3PhiEnd]"
        rMin="[InnerRingRMin]" rMax="[InnerRingRMax]" dz="[EndSegment3Width] / 2.0"/>
  <Tubs name="PixelForwardInnerRingCFEndSegment3" startPhi="90.*deg+[InnerRingPhiEnd]" deltaPhi="-[InnerRingPhiEnd]+[EndSegment3PhiEnd]"
        rMin="[InnerRingCFRMin]" rMax="[InnerRingCFRMax]" dz="[EndSegment3Width] / 2.0"/>

</SolidSection>

<LogicalPartSection label="pixfwdInnerDisk1.xml">
 <LogicalPart name="PixelForwardInnerRingSegment" category="support">
  <rSolid name="PixelForwardInnerRingSegment"/>
  <rMaterial name="materials:C_C_InnerInnerRing"/>
 </LogicalPart>
 <LogicalPart name="PixelForwardInnerRingCFSegment" category="support">
  <rSolid name="PixelForwardInnerRingCFSegment"/>
  <rMaterial name="materials:FPix_CFSkin_InnerInnerRing"/>
 </LogicalPart>

 <LogicalPart name="PixelForwardOuterRingSegment" category="support">
  <rSolid name="PixelForwardOuterRingSegment"/>
  <rMaterial name="materials:C_C_InnerOuterRing"/>
 </LogicalPart>
 <LogicalPart name="PixelForwardOuterRingCFSegment" category="support">
  <rSolid name="PixelForwardOuterRingCFSegment"/>
  <rMaterial name="materials:FPix_CFSkin_InnerOuterRing"/>
 </LogicalPart>

 <LogicalPart name="PixelForwardInnerRingEndSegment1" category="support">
  <rSolid name="PixelForwardInnerRingEndSegment1"/>
  <rMaterial name="materials:C_C_InnerInnerRing"/>
 </LogicalPart>
<!-- <LogicalPart name="PixelForwardInnerRingEndSegment2" category="support">
  <rSolid name="PixelForwardInnerRingEndSegment2"/>
  <rMaterial name="materials:C_C_InnerInnerRing"/>
 </LogicalPart> -->
<LogicalPart name="PixelForwardInnerRingEndSegment3" category="support">
  <rSolid name="PixelForwardInnerRingEndSegment3"/>
  <rMaterial name="materials:C_C_InnerInnerRing"/>
 </LogicalPart>


 <LogicalPart name="PixelForwardInnerRingCFEndSegment1" category="support">
  <rSolid name="PixelForwardInnerRingCFEndSegment1"/>
  <rMaterial name="materials:FPix_CFSkin_InnerInnerRing"/>
 </LogicalPart>
<!-- <LogicalPart name="PixelForwardInnerRingCFEndSegment2" category="support">
  <rSolid name="PixelForwardInnerRingCFEndSegment2"/>
  <rMaterial name="materials:FPix_CFSkin_InnerInnerRing"/>
 </LogicalPart> -->
 <LogicalPart name="PixelForwardInnerRingCFEndSegment3" category="support">
  <rSolid name="PixelForwardInnerRingCFEndSegment3"/>
  <rMaterial name="materials:FPix_CFSkin_InnerInnerRing"/>
 </LogicalPart>
</LogicalPartSection>

<PosPartSection label="pixfwdInnerDisk1.xml">
  <PosPart copyNumber="1">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingEndSegment1"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide1Z] - [EndSegment1Width]/2."/>
  </PosPart>
  <PosPart copyNumber="2">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingEndSegment1"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide1Z] - [EndSegment1Width]/2."/>
    <rRotation name="pixfwdCommon:Z180"/>
  </PosPart>
  <PosPart copyNumber="1">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingCFEndSegment1"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide1Z] - [EndSegment1Width]/2."/>
  </PosPart>
  <PosPart copyNumber="2">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingCFEndSegment1"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide1Z] - [EndSegment1Width]/2."/>
    <rRotation name="pixfwdCommon:Z180"/>
  </PosPart>

<!--
  <PosPart copyNumber="1">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingEndSegment2"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide1Z] - [EndSegment1Width] - [EndSegment2Width]/2."/>
  </PosPart>
 <PosPart copyNumber="2">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingEndSegment2"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide1Z] - [EndSegment1Width] - [EndSegment2Width]/2."/>
    <rRotation name="pixfwdCommon:Z180"/>
 </PosPart> -->

  <PosPart copyNumber="1">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingEndSegment3"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide2Z] + [EndSegment3Width]/2."/>
  </PosPart>
  <PosPart copyNumber="2">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingEndSegment3"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide2Z] + [EndSegment3Width]/2."/>
    <rRotation name="pixfwdCommon:Z180"/>
  </PosPart>
 <PosPart copyNumber="1">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingCFEndSegment3"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide2Z] + [EndSegment3Width]/2."/>
  </PosPart>
  <PosPart copyNumber="2">
    <rParent name="pixfwdDisks:PixelForwardDisk1"/>
    <rChild name="pixfwdInnerDisk1:PixelForwardInnerRingCFEndSegment3"/>
    <Translation x="0.0*mm" y="0.0*mm" z="[InnerRingZ] + [EndSegmentSide2Z] + [EndSegment3Width]/2."/>
    <rRotation name="pixfwdCommon:Z180"/>
  </PosPart>

</PosPartSection>


<Algorithm name="track:DDPixFwdSupportRing">
  <rParent name="pixfwdDisks:PixelForwardDisk1"/>
  <String  name="Child1Name"       value="pixfwdInnerDisk1:PixelForwardInnerRingSegment"/>
  <String  name="Child2Name"       value="pixfwdInnerDisk1:PixelForwardInnerRingCFSegment"/>
  <Numeric name="StartCopyNo"      value="0"/>
  <Numeric name="Count"            value="[InnerRingTubsCount]"/>
  <Numeric name="AnchorZ"          value="[InnerRingZ] + 14.343*mm"/>
  <Vector name="Angle" type="numeric" nEntries="5">
    33.862*deg, 54.629*deg, 74.862*deg, 112.862*deg, 154.862*deg
  </Vector>
  <Vector name="ZPos" type="numeric" nEntries="5">
    -8.0*mm, -16.0*mm, -15.0*mm, -6.0*mm, -21.0*mm
  </Vector>
  <Numeric name="CreateBothHalves" value="1"/>
  <String  name="RotationName"    value="pixfwdInnerDisk1:InnerRingSegment"/>
</Algorithm>

<Algorithm name="track:DDPixFwdSupportRing">
  <rParent name="pixfwdDisks:PixelForwardDisk1"/>
  <String  name="Child1Name"       value="pixfwdInnerDisk1:PixelForwardOuterRingSegment"/>
  <String  name="Child2Name"       value="pixfwdInnerDisk1:PixelForwardOuterRingCFSegment"/>
  <Numeric name="StartCopyNo"      value="0"/>
  <Numeric name="Count"            value="[OuterRingTubsCount]"/>
  <Numeric name="AnchorZ"          value="[OuterRingZ]"/>
  <Vector name="Angle" type="numeric" nEntries="7">
    5.0*deg, 20.0*deg, 60.0*deg, 80.0*deg, 103.0*deg, 110.0*deg, 175.0*deg
  </Vector>
  <Vector name="ZPos" type="numeric" nEntries="7">
    9.234*mm, 8.666*mm, -1.560*mm, -3.052*mm, 9.023*mm, 9.278*mm, -9.120*mm
  </Vector>
  <Numeric name="CreateBothHalves" value="1"/>
  <String  name="RotationName"    value="pixfwdInnerDisk1:OuterRingSegment"/>
</Algorithm>

</DDDefinition>
